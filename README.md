# 进程监控工具 (Process Monitor)

## 简介

进程监控工具是一个用Python编写的Linux系统实用程序，用于监控系统中的进程CPU使用情况，并自动终止长时间占用高CPU资源的进程。该工具特别适用于服务器环境，可以防止某些失控的进程导致系统资源耗尽。

## 功能特点

- 实时监控所有系统进程的CPU使用率
- 自动识别并记录高CPU使用率的进程
- 当进程持续高CPU使用超过设定的时间阈值时自动终止
- 提供日志记录功能，详细记录监控和终止的进程信息
- 避免终止关键系统进程
- 优雅地尝试终止进程，首先使用SIGTERM信号，然后才使用SIGKILL

## 系统要求

- Python 3.6或更高版本
- psutil库（`pip install psutil`）
- Linux系统环境
- 需要root权限才能运行

## 配置参数

工具提供了以下可配置的参数（在源代码的开头部分）：

- `CPU_THRESHOLD`: CPU使用率阈值，默认为95%
- `MONITOR_INTERVAL`: 检查间隔时间，默认为1秒
- `DURATION_THRESHOLD`: 持续高CPU使用的时间阈值，默认为40秒

您可以根据自己系统的需求修改这些参数。

## 使用方法

1. 确保安装了必要的依赖库：
   ```
   pip install psutil
   ```

2. 以root权限运行脚本：
   ```
   sudo python3 process_monitor.py
   ```

3. 程序将在后台运行，监控所有进程。当发现持续高CPU使用的进程时，会自动终止并记录在日志中。

4. 程序输出和详细日志会保存在同目录下的`process_monitor.log`文件中。

## 日志信息

程序会在运行目录生成`process_monitor.log`日志文件，记录以下信息：

- 程序启动和停止信息
- 检测到的高CPU进程
- 进程终止的详细信息
- 任何发生的错误

## 注意事项

- 该工具需要root权限才能正常运行，因为终止某些进程需要特殊权限
- 工具会自动跳过一些关键的系统进程（如systemd, init, kernel等）
- 在生产环境使用前，建议先在测试环境验证并根据需要调整配置参数

## 安全提示

谨慎使用此工具，尤其是在生产环境中。过度激进的配置可能会导致重要程序被错误地终止。建议在首次使用时，适当放宽CPU和持续时间阈值，逐步调整到适合您系统的配置。 